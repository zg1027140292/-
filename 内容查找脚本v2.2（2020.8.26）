# -*- coding: UTF-8 â€“*-
import msvcrt
import time
import os
time_now = time.strftime('%Y-%m-%d %H:%M:%S')


path = os.getcwd()  #è·å–è½¯ä»¶å½“å‰è¿è¡Œè·¯å¾„
print(path)
ifdir1 = os.path.isdir("ç»“æœ")  #åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨
if ifdir1 is False:  #å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶å¤¹
    os.mkdir("ç»“æœ")
with open("ç»“æœ\ç»“æœ.txt",'w') as f: #åˆ›å»ºç»“æœ.txtæ¥ä¿å­˜æœ€ç»ˆéœ€è¦çš„ç»“æœ
    path1 = os.path.realpath("ç»“æœ\ç»“æœ.txt")  #æ ‡è®°ç»“æœ.txtçš„ç»å¯¹è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»º

#=============================== ä¸Šè¿°ä»£ç æ ‡è®°æ‰€æœ‰éœ€è¦çš„è·¯å¾„ ====================================

FN = os.listdir(path) #è·å–æ–‡ä»¶ååˆ—è¡¨
count = 0
count_txt = 0
a = []
while True:
    title = '''
      ================================================
                             é¦–é¡µ
            å½“å‰æ—¶é—´ä¸ºï¼š%s
       1ã€æœç´¢å•å­—ç¬¦ä¸²ï¼ˆåªèƒ½æœç´¢æŸä¸€ä¸ªç‰¹å®šçš„å†…å®¹ï¼Œå¯å¤šæ¬¡æœç´¢ä¸åŒçš„ç‰¹å®šå†…å®¹ï¼‰
       2ã€æœç´¢æ‹¼æ¥å­—ç¬¦ä¸² ï¼ˆå¯æœç´¢å¤šä¸ªæ–‡ä»¶ä¸­çš„ç›¸ä¼¼å†…å®¹)
      =============================ä½œè€…ï¼šç¼˜æ¥ç”»ä¸­äºº======
    ''' % time_now
    print(title)
    choose = input("è¯·è¾“å…¥åŠŸèƒ½åºåˆ—å·ï¼š")
    if choose == "1":
        title1 = '''
          ================================================
                        å•å­—ç¬¦æœç´¢å·¥å…·
                å½“å‰æ—¶é—´ä¸ºï¼š%s
           1ã€è¾“å…¥â€œ~â€ç ´æµªé”®æ‰“å¼€ç»“æœæ–‡ä»¶
           2ã€è¾“å…¥â€œ~~â€åŒç ´æµªé”®è¿”å›ä¸Šå±‚èœå•
          =============================ä½œè€…ï¼šç¼˜æ¥ç”»ä¸­äºº======
        ''' % time_now
        print(title1)
        while True:
            yesno = input("æ˜¯å¦å°†æœç´¢å†…å®¹æ‰€åœ¨æ•´è¡Œå†…å®¹è¾“å‡ºåˆ°ç»“æœæ–‡ä»¶ä¸­ï¼Ÿï¼ˆY/Nï¼‰ï¼š")
            if yesno == "y" or yesno == "n" or yesno == "Y" or yesno == "N":
                break
            else:
                print("æ‚¨è¾“å…¥çš„å‘½ä»¤æœ‰è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼ˆY/Nï¼‰")
                continue
        break_father = True
        while break_father == True:
            data = input("è¯·è¾“å…¥è¦æŸ¥æ‰¾çš„å†…å®¹ï¼š")
            count += 1
            if data == "~":
                os.system(path1)  # è‡ªåŠ¨æ‰“å¼€ç»“æœæ–‡ä»¶
                print("å·²ä¸ºæ‚¨æ‰“å¼€ç»“æœæ–‡ä»¶")
                continue
            if data == "~~":
                break
            with open(path1, 'a+', encoding='utf-8') as filetxt:
                print('ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ä»¥ä¸‹æ˜¯ç¬¬%sæ¬¡æœç´¢çš„å†…å®¹%sï¼Œ%s ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡' % (count, data, time_now), file=filetxt)
                for filename in FN:
                    if os.path.splitext(filename)[1] in ('.txt','.log'):
                        path2 = (path+'/'+filename)
                        with open(os.path.join(path,filename),'r',encoding='utf-8') as f: #æ‰“å¼€è·¯å¾„pathä¸‹çš„æ‰€æœ‰æ–‡ä»¶
                            for line in f:
                                if data in line:
                                    a.append(line)
                                    count_txt +=1
                            if count_txt > 0:
                                print(filename, '==========>å‡ºç° %s æ¬¡æ•°ï¼š%s æ¬¡' % (data, count_txt), file=filetxt)
                            if count_txt == 0:
                                print(filename,"==========>æœªå‘ç°å½“å‰æœç´¢å†…å®¹", file=filetxt)
                            count_txt = 0
                            f.close
                        if yesno == "Y" or yesno == "y":
                            for i in a:
                                print("%s" % i, file=filetxt)
                        elif yesno == 'N' or yesno == "n":
                            pass
                        else:

                            a.clear()
                print("å·²å°†ç»“æœè¾“å‡ºåˆ°â€œç»“æœ.txtâ€æ–‡ä»¶ä¸­ï¼Œè¯·è¾“å…¥â€œ~â€æ³¢æµªé”®æŸ¥çœ‹å†…å®¹ã€‚")
    if choose == "2":
        title2 = '''
              ================================================
                                æ‹¼æ¥æœç´¢å·¥å…·
                    å½“å‰æ—¶é—´ä¸ºï¼š%s
               1ã€æƒ³è¦æœç´¢å¤šä¸ªæ–‡ä»¶ä¸­çš„ç›¸ä¼¼å†…å®¹
               ä¾‹å¦‚ï¼šæ–‡ä»¶1ä¸­æœ‰â€œæˆ‘å–œæ¬¢52è®ºå›â€ï¼Œæ–‡ä»¶2ä¸­æœ‰â€œæˆ‘å–œæ¬¢å¦ä¸€ä¸ªè®ºå›â€ï¼Œ
               æ­¤æ—¶æœç´¢â€œæˆ‘å–œæ¬¢â€+â€œè®ºå›â€ã€‚
               2ã€è¾“å…¥â€œ~â€ç ´æµªé”®æ‰“å¼€ç»“æœæ–‡ä»¶
               3ã€è¾“å…¥â€œ~~â€åŒç ´æµªé”®è¿”å›ä¸Šå±‚èœå•
              =============================ä½œè€…ï¼šç¼˜æ¥ç”»ä¸­äºº======
            ''' % time_now
        print(title2)
        while True:
            yesno = input("æ˜¯å¦å°†æœç´¢å†…å®¹æ‰€åœ¨æ•´è¡Œå†…å®¹è¾“å‡ºåˆ°ç»“æœæ–‡ä»¶ä¸­ï¼Ÿï¼ˆY/Nï¼‰ï¼š")
            if yesno == "y" or yesno == "n" or yesno == "Y" or yesno == "N":
                break
            else:
                print("æ‚¨è¾“å…¥çš„å‘½ä»¤æœ‰è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼ˆY/Nï¼‰")
                continue
        break_father = True
        while break_father == True:
            while break_father == True:
                data1 = input("è¯·è¾“å…¥è¦æœç´¢çš„å¤´å†…å®¹ï¼š")
                if data1 == "~~"  :
                    break_father = False
                    pass
                elif data1 == "~":
                    os.system(path1)  # è‡ªåŠ¨æ‰“å¼€ç»“æœæ–‡ä»¶
                    print("å·²ä¸ºæ‚¨æ‰“å¼€ç»“æœæ–‡ä»¶")
                    pass
                else:
                    break
            if break_father == False:
                break
            data2 = input("è¯·è¾“å…¥è¦æœç´¢çš„å°¾å†…å®¹ï¼š")
            count += 1
            with open(path1, 'a+', encoding='utf-8') as filetxt:
                print('ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ä»¥ä¸‹æ˜¯ç¬¬%sæ¬¡æœç´¢çš„å†…å®¹%sï¼Œ%s ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡\n' % (count,(data1,"***",data2), time_now), file=filetxt)
                for filename in FN:
                    if os.path.splitext(filename)[1] in ('.txt','.log'):
                        path2 = (path+'/'+filename)
                        with open(os.path.join(path,filename),'r',encoding='utf-8') as f: #æ‰“å¼€è·¯å¾„pathä¸‹çš„æ‰€æœ‰æ–‡ä»¶
                            for line in f:
                                if data1 in line and data2 in line:
                                    a.append(line)
                                    count_txt +=1
                            if count_txt > 0:
                                print(filename, '==========>å‡ºç° %s æ¬¡æ•°ï¼š%s æ¬¡' % ((data1, "***", data2), count_txt), "å†…å®¹ä¸ºï¼š\n",file=filetxt)
                            if count_txt == 0:
                                print(filename,"==========>æœªå‘ç°å½“å‰æœç´¢å†…å®¹", file=filetxt)
                        if yesno == "Y" or yesno == "y":
                            for i in a:
                                print("%s" % i, file=filetxt)
                        elif yesno == 'N' or yesno == "n":
                            pass

                        a.clear()
                        count_txt = 0
                print("å·²å°†ç»“æœè¾“å‡ºåˆ°â€œç»“æœ.txtâ€æ–‡ä»¶ä¸­ï¼Œè¯·è¾“å…¥â€œ~â€æ³¢æµªé”®æŸ¥çœ‹å†…å®¹ã€‚")
